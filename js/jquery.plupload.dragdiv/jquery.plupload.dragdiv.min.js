(function(d,f){var e={};function b(g){return plupload.translate(g)||g}function c(h,g){g.contents().each(function(j,k){k=d(k);if(!k.is(".plupload")){k.remove()}});g.after('<div id="'+h+'_filelist_dg" class="'+h+'_filelist_dg uploader_dragdiv_filelist_dg" style="display:none; max-height: 90%; z-index:66002"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button id="'+h+'_filelist_dg_close_btn" type="button" class="close"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title" id="'+h+'_filelist_dgLabel">Файлы загружаются</h4></div><div class="modal-body" id="'+h+'_filelist_dg_body"><div class="plupload_dragdiv_progress"><div class="plupload_dragdiv_progress_container"><div class="progress"><div class="progress-bar plupload_total_progress_bar progress-bar-striped active progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">&nbsp;</div></div></div><div class="plupload_dragdiv_filelist_footer"><div class="plupload_dragdiv_file_name"><span class="plupload_dragdiv_upload_status"></span></div><div class="plupload_dragdiv_file_action"></div><div class="plupload_dragdiv_file_size"><span class="plupload_total_file_size">0</span></div></div><div class="clearfix">&nbsp;</div></div><ul id="'+h+'_filelist" class="plupload_dragdiv_filelist"></ul></div></div></div></div>');g.prepend('<div class="plupload_dragdiv_wrapper plupload_dragdiv_scroll" style="width:100%; height: 100%"><div id="'+h+'_container" class="plupload_dragdiv_container" style="width:100%; height: 100%"><div style="width:100%; height: 100%"><div class="plupload_dragdiv_content" style="width:100%; height: 100%"><ul id="'+h+'_droparea" class="plupload_dragdiv_droparea" style="width:100%; height: 100%"></ul></div></div></div><input type="hidden" id="'+h+'_count" name="'+h+'_count" value="0" /></div>');jQuery("#"+h+"_filelist_dg_close_btn").click(function(){jQuery("#"+h).pluploadDragDiv().splice();jQuery("#"+h+"_filelist_dg").hide("slide",{direction:"right",easing:"easeOutBounce"},1200,function(){})})}function a(h,g){jQuery(g.droparea).on({dragenter:function(k){if(!g.droparea_fullscreen){var l=jQuery(g.droparea).offset();var j=jQuery(g.droparea).width();var i=jQuery(g.droparea).width();jQuery("#"+h).css("left",l.left).css("top",l.top).css("width",j+"px").css("height",i+"px")}else{jQuery("#"+h).css("left","0").css("top","0").css("width","100%").css("height","100%")}jQuery("#"+h+" .plupload_dragdiv_droptext").show()}});jQuery("#"+h).on({dragleave:function(i){jQuery("#"+h).css("left",0).css("top",0).css("width","1px").css("height","1px");jQuery("#"+h+" .plupload_dragdiv_droptext").hide()},drop:function(i){jQuery("#"+h).css("left",0).css("top",0).css("width","1px").css("height","1px");jQuery("#"+h+" .plupload_dragdiv_droptext").hide();i.stopPropagation();i.preventDefault()}})}d.fn.pluploadDragDiv=function(g){if(g){this.each(function(){var n,m,o,i;m=d(this);o=m.attr("id");if(!o){o=plupload.guid();m.attr("id",o)}i=m.html();c(o,m);g=d.extend({dragdrop:true,browse_button:o+"_browse",container:o,droparea:"#"+o+"_file_droparea",droparea_fullscreen:false},g);if(typeof g.runtimes==="undefined"){g.runtimes="html5,flash,silverlight,html4"}if(typeof g.flash_swf_url==="undefined"){g.flash_swf_url="js/plupload/js/Moxie.swf"}if(typeof g.silverlight_xap_url==="undefined"){g.silverlight_xap_url="js/plupload/js/Moxie.xap"}if(typeof g.max_file_size==="undefined"){g.max_file_size="2048mb"}if(typeof g.chunk_size==="undefined"){g.chunk_size="900kb"}if(typeof g.unique_names==="undefined"){g.unique_names=false}a(o,g);if(g.dragdrop){g.drop_element=o+"_droparea"}n=new plupload.Uploader(g);e[o]=n;function l(p){var r;if(p.status==plupload.DONE){r="plupload_dragdiv_done"}if(p.status==plupload.FAILED){r="plupload_dragdiv_failed"}if(p.status==plupload.QUEUED){r="plupload_dragdiv_delete"}if(p.status==plupload.UPLOADING){r="plupload_dragdiv_uploading"}var q=d("#"+p.id).attr("class",r+" clearfix").find("a").css("display","block");if(p.hint){q.attr("title",p.hint)}}function h(){d("div.plupload_total_progress_bar").css("width",n.total.percent+"%");d("span.plupload_dragdiv_upload_status").html(f.sprintf(b("Uploaded %d/%d files"),n.total.uploaded,n.files.length))}function j(){jQuery("#"+o+"_filelist_dgLabel").html("Загрузка файлов...");var q=d("#"+o+"_filelist").html(""),r=0,p;d.each(n.files,function(t,s){p="";if(s.status==plupload.DONE){if(s.target_name){p+='<input type="hidden" name="'+o+"_"+r+'_tmpname" value="'+plupload.xmlEncode(s.target_name)+'" />'}p+='<input type="hidden" name="'+o+"_"+r+'_name" value="'+plupload.xmlEncode(s.name)+'" />';p+='<input type="hidden" name="'+o+"_"+r+'_status" value="'+(s.status==plupload.DONE?"done":"failed")+'" />';r++;d("#"+o+"_count").val(r)}q.prepend('<li id="'+s.id+'" class="clearfix ui-state-default plupload_dragdiv_delete"><a class="plupload_dragdiv_delete"></a><div class="plupload_dragdiv_file_action"><a href="#"></a></div><div class="plupload_dragdiv_file_name"><span>'+s.name+'</span></div><div class="plupload_dragdiv_file_size">'+plupload.formatSize(s.size)+'</div><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">&nbsp;</div></div>'+p+"</li>");l(s);d("#"+s.id+".plupload_dragdiv_delete a").click(function(u){d("#"+s.id).remove();n.removeFile(s);u.preventDefault()})});d("span.plupload_total_file_size").html(plupload.formatSize(n.total.size));if(n.total.queued===0){d("span.plupload_add_text").html(b("Add Files"))}else{d("span.plupload_add_text").html(f.sprintf(b("%d files queued"),n.total.queued))}q[0].scrollTop=q[0].scrollHeight;h()}function k(){delete e[o];n.destroy();m.html(i);n=m=i=null}n.bind("UploadFile",function(p,q){d("#"+q.id).addClass("plupload_current_file")});n.bind("Init",function(p,q){if(!g.unique_names&&g.rename){m.on("click","#"+o+"_filelist div.plupload_dragdiv_file_name span",function(w){var u=d(w.target),s,v,r,t="";s=p.getFile(u.parents("li")[0].id);r=s.name;v=/^(.+)(\.[^.]+)$/.exec(r);if(v){r=v[1];t=v[2]}u.hide().after('<input type="text" />');u.next().val(r).focus().blur(function(){u.show().next().remove()}).keydown(function(y){var x=d(this);if(y.keyCode==13){y.preventDefault();s.name=x.val()+t;u.html(s.name);x.blur()}})})}d("#"+o+"_container").attr("title","Using runtime: "+q.runtime);d("a.plupload_stop").click(function(r){r.preventDefault();n.stop()})});n.bind("FilesAdded",function(p,q){n.start();jQuery("#"+o+"_filelist_dg").show()});n.bind("Error",function(p,s){var q=s.file,r;if(q){r=s.message;if(s.details){r+=" ("+s.details+")"}if(s.code==plupload.FILE_SIZE_ERROR){alert(b("Error: File too large:")+" "+q.name)}if(s.code==plupload.FILE_EXTENSION_ERROR){alert(b("Error: Invalid file extension:")+" "+q.name)}q.hint=r;d("#"+q.id).attr("class","plupload_dragdiv_failed").find("a").css("display","block").attr("title",r)}if(s.code===plupload.INIT_ERROR){setTimeout(function(){k()},1)}});n.bind("PostInit",function(p){if(p.settings.dragdrop&&p.features.dragdrop){d("#"+o+"_droparea").append('<li><button class="btn btn-sm btn-default pull-right" onclick="jQuery(\'#'+o+"').css('left',0).css('top',0).css('width','1px').css('height','1px')\"><span class=\"glyphicon glyphicon-remove\"></span></button></li>");d("#"+o+"_droparea").append('<li class="plupload_dragdiv_droptext"><span class="icon-upload-cloud"></span></li>')}});n.init();n.bind("StateChanged",function(){if(n.state===plupload.STARTED){d("li.plupload_dragdiv_delete a").hide();d("span.plupload_dragdiv_upload_status,div.plupload_dragdiv_progress,a.plupload_stop").css("display","block");d("span.plupload_dragdiv_upload_status").html("Uploaded "+n.total.uploaded+"/"+n.files.length+" files");if(g.multiple_queues){d("span.plupload_total_status,span.plupload_total_file_size").show()}}else{j();d("a.plupload_stop,div.plupload_dragdiv_progress").hide();d("a.plupload_dragdiv_delete").css("display","block");if(g.multiple_queues&&n.total.uploaded+n.total.failed==n.files.length){d(".plupload_dragdiv_upload_status").css("display","inline");d("span.plupload_total_status,span.plupload_total_file_size").hide()}}});n.bind("FilesAdded",j);n.bind("UploadComplete",function(){jQuery("#"+o+"_filelist_dgLabel").html("Загрузка завершена");setTimeout('jQuery("#'+o+'_filelist_dg").hide("slide", { direction: "right", easing: "easeOutBounce" },1200, function(){}); jQuery("#'+o+'").pluploadDragDiv().splice();',2000)});n.bind("FilesRemoved",function(){var p=d("#"+o+"_filelist").scrollTop();j();d("#"+o+"_filelist").scrollTop(p)});n.bind("FileUploaded",function(p,q){l(q)});n.bind("UploadProgress",function(p,q){d("#"+q.id+" div.progress-bar").css("width",q.percent+"%");l(q);h()});if(g.setup){g.setup(n)}});return this}else{return e[d(this[0]).attr("id")]}}})(jQuery,mOxie);